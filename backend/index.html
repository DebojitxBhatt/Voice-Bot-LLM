<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Voice Chatbot</title>
</head>
<body>
  <h1>🎙️ Talk to Your Voice Bot</h1>
  <button id="startBtn">Start Talking</button>
  <p><strong>You said:</strong> <span id="userText"></span></p>
  <p><strong>Bot replied:</strong> <span id="botText"></span></p>
  <audio id="botAudio" controls></audio>

  <script>
    const startBtn = document.getElementById('startBtn');
    const userText = document.getElementById('userText');
    const botText = document.getElementById('botText');
    const botAudio = document.getElementById('botAudio');

    const recognition = new(window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    startBtn.onclick = () => {
      recognition.start();
    };

    recognition.onresult = async (event) => {
      const spokenText = event.results[0][0].transcript;
      userText.textContent = spokenText;

      const res = await fetch('http://localhost:3000/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: spokenText })
      });

      const data = await res.json();
      botText.textContent = data.text;
      botAudio.src = `http://localhost:3000/audio/${data.audioFile}`;
      botAudio.play();
    };

    recognition.onerror = (e) => {
      alert('Error with voice recognition: ' + e.error);
    };
  </script>
</body>
</html>
